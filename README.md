# URL Lookup Service

A small HTTP service that determines whether a given URL is considered malicious.
It is designed to be queried by an HTTP proxy before allowing outbound connections.

The service is built with FastAPI and uses PostgreSQL as the primary data source.
It includes fallback logic and structured logging to handle failure scenarios gracefully.

---

## Requirements

The recommended way to run the project is using Docker.

Required:

* Docker

* Docker Compose

---

## Project Structure

```bash
├── app/ # Application source code
├── tests/ # Automated tests
├── docker-compose.yml # Service orchestration (API + PostgreSQL)
├── Dockerfile # API container definition
├── pyproject.toml # Python dependencies and project metadata
└── README.md # Project documentation
```
---

## Setup and running the service

Clone the repository:

```bash
git clone https://github.com/GeraldOpitz/url-lookup-service
cd url-lookup-service
```

Start the service using Docker Compose:

```bash
docker compose up --build
```

or using:

```bash
make docker-up
```

The API will be available at:

```bash
http://localhost:8000/urlinfo/1/
```

And you can use it by adding the hostname and path you want to check:

Example (malicious URL)
```bash
Http://localhost:8000/urlinfo/1/www.bad.com/malware
```


PostgreSQL will be started automatically as part of the same setup.

---

## API Documentation (Swagger)

This service provides interactive API documentation using Swagger UI, automatically generated by FastAPI.

Once the service is running, open the following URL in your browser:
```bash
http://localhost:8000/docs
```
From there you can:
* Explore all available endpoints
* Read detailed request and response descriptions
* Execute real requests against the running service

---

## API Usage

The recommended way to use the service is through Swagger UI.

#### Instructions

1. Open Swagger UI in your browser:
```bash
http://127.0.0.1:8000/docs
```
2. Locate the endpoint:
The recommended way to use the service is through Swagger UI.

#### Instructions

1. Open Swagger UI in your browser:
```bash
http://127.0.0.1:8000/docs
```
2. Locate the endpoint:
```bash
GET /urlinfo/1/{hostname_and_port}/{path_and_query}
```

3. Click the "Try it out" button.
   
4. Fill the required fields:
* hostname_and_port:  
  Example: www.google.com
* path_and_query:  
  Example: search?q=test

5. Click "Execute" to send the request.

---


## Example responses

#### Safe URL

Example
```bash
GET /urlinfo/1/www.google.com/search?q=test
```

Response
```bash
{
  "url": "www.google.com/search?q=test",
  "safe": true
}
```
#### Malicious URL

Example
```bash
GET /urlinfo/1/www.bad.com/malware
```
Response
Response
```bash
{
  "url": "www.bad.com/malware",
  "safe": false,
  "reason": "URL found in malware database"
}
```
---

## Database and fallback behavior

The service uses PostgreSQL as the primary source of malicious URLs.

If the database is unavailable at runtime:
* The service does not crash
* A fallback mechanism is used instead
* Requests are still served with a safe default behavior

This approach improves resilience and avoids total service failure due to infrastructure issues.

---

## Logging

The application includes structured logging for:

* Incoming requests
* Database lookups
* Fallback activation
* Unexpected errors

Logs are written to standard output and are compatible with container-based
logging systems.

---

## Running tests

To run the test suite:

```bash
pytest
```
To run tests with coverage:

```bash
pytest -v --cov=app
```

or using:

```bash
make test
```
